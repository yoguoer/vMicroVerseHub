<template>
  <div class="test-msg">
    <h1>sub-app-second</h1>
    <h3>æµ‹è¯•ç»™ä¸»åº”ç”¨å‘é€ä¿¡æ¯~</h3>
    <div>
      <el-button @click="testSendMessage" type="primary">ç‚¹å‡»å‘é€ä¿¡æ¯</el-button>
      <el-button @click="testReceiveMessage" type="warning">ç‚¹å‡»æ¥æ”¶ä¿¡æ¯</el-button>
    </div>
  </div>
</template>

<script setup>
import { getMicroAppMessage } from "v-micro-app-plugin";

const microAppMessage = getMicroAppMessage();
function testSendMessage() {
  microAppMessage.sendMessage({
    data: { app: "appSecond", value: "ğŸ¦„appSecondç»™ä¸»åº”ç”¨å‘é€æ•°æ®~sendMessage" },
    callback: () => {
      console.log("ğŸ¦„appSecondä½¿ç”¨sendMessageå‘é€æ•°æ®æˆåŠŸï¼Œæ‰§è¡Œå›è°ƒï¼");
    },
  });
  microAppMessage.sendGlobal({
    data: { fun: "sendGlobal", text: "ğŸ’appSecondç»™å…¨å±€å‘é€æ•°æ®~sendGlobal" },
    callback: () => {
      console.log("ğŸ’appSecondä½¿ç”¨sendGlobalå‘é€æ•°æ®æˆåŠŸï¼Œæ‰§è¡Œå›è°ƒï¼");
    },
  });
}

function testReceiveMessage(){
  setTimeout(() => {
    console.log(
      "ğŸ³appSecondæ¥æ”¶åˆ°çš„å…¨å±€ä¿¡æ¯getGlobalMessageï¼š",
      microAppMessage.getGlobalMessage(),
      "ğŸ³æ¥æ”¶åˆ°ä¸»åº”ç”¨å‘æ¥çš„éå…¨å±€ä¿¡æ¯getMessageï¼š",
      microAppMessage.getMessage()
    );
  }, 1000);
}
</script>

<style scoped>
.test-msg {
  text-align: center;
  padding-top: 100px;
  height: 90vh;
}
</style>
